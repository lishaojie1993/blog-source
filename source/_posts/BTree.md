---
title: Mysql索引,B+Tree详解
date: 2019-03-16 23:00:13
categories: 
  - Java
  - 数据结构
tags: 
  - 数据结构
  - B+Tree
top_img: https://tva1.sinaimg.cn/large/006tNbRwgy1gash4k2x0uj31900u0b1g.jpg
---

## Mysql索引？

### 索引是什么？

索引是为了加速对表中数据行的检索而创建的一种分散存储的**数据结构**。

### 为什么要创建索引？

1. 创建索引可以大大提高系统的查询性能。
2. 通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。
3. 可以加速表和表之间的连接，特别是在实现数据的参考完整性方面。
4. 在使用分组喝排序子句进行数据检索时，同样可以显著减少查询中分组喝排序的时间。
5. 通过使用索引，可以在查询过程中，使用优化隐藏器，提高系统的性能。

<!-- More -->

### 索引的缺点

1. 创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加。
2. 除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如要建立聚集索引，则需要空间更大。
3. 当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，降低了数据的维护速度。

### 适合添加索引的字段

经常需要搜索的列、主键、外键、经常需要范围查询的列、经常需要排序的列、经常使用的where子句的列。

注意：建立索引一般按照select的where条件来建立，比如条件是where f1 and f2，需要在f1、f2上同时建立。

### 不适合添加索引的字段

查询中很少使用的字段、区分度不高的列、text,image,bit等数据量大的列、修改性能大于检索性能不要加。

## 二叉树的缺陷

**搜索效率不足，树的深度不可控。**（树的深度决定着搜索时IO次数）

**节点数据内容太少。**（没有很好的利用系统和磁盘的数据交换特性）

## B-树的特点

B-树是一种多路平衡二叉树，相比于二叉树大大降低了树的高度，减少了磁盘IO。

## B+树的特点

1. 每一个根节点的元素都出现在子节点中，是子节点的最大（或最小）元素。
2. 根节点的最大元素就是整个B+树的最大元素，无论插入删除多少元素，始终保持最大元素在根节点中。
3. 由于特点1，所以叶子节点包含了全量的元素信息。
4. 每一个叶子节点都带有指向下一个节点的指针，形成了一个有序链表。

### 卫星数据的位置

在B-树中，无论中间节点还是叶子节点都带有卫星数据。

![](https://tva1.sinaimg.cn/large/006tNbRwgy1gay4wwcz3lj30ji0brae3.jpg)

在B+树中，只有叶子节点带有卫星数据，其余中间节点仅仅是索引，没有任何数据关联。

![](https://tva1.sinaimg.cn/large/006tNbRwgy1gay4x092ahj30jk0bfjv0.jpg)

PS：在数据库的聚集索引(Clustered Index)中，叶子节点直接包含卫星数据；在非聚集索引(NonClustered Index)中，叶子节点带有指向卫星数据的指针。

### B+树的优点

- B+树的中间节点没有卫星数据，所以同样大小的磁盘页可以容纳更多的元素，这就意味着数据量相同的情况下，B+树的结构比B-树更加“矮胖”，因此查询时IO次数更少。
- B+树的查找性能更稳定，因为B+树的查询必须最终查找到叶子节点，而B-树只要找到匹配元素即可，所以B-树的查找性能不如B+树稳定。
- 在范围查找方面，B-树只能依靠繁琐的中序遍历，反观B+树则要简单的多，只需要在链表上做遍历即可。

**综上所述，B+树相比于B-树的优势有三个**

1. 单一节点存储更多的元素，使得查询的IO次数更少。
2. 所有查询都要查找到子节点，查询性能稳定。
3. 所有叶子节点形成有序链表，便于范围查询。

## 最左匹配原则

![](https://tva1.sinaimg.cn/large/006tNbRwgy1gay93ok47nj30sz0gj45e.jpg)

## 联合索引

![](https://tva1.sinaimg.cn/large/006tNbRwgy1gay94rzzm0j30sy0ef47q.jpg)

## 覆盖索引

![](https://tva1.sinaimg.cn/large/006tNbRwgy1gay95n2xzmj30sp0i4gyc.jpg)